<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="google-adsense-account" content="ca-pub-6495605335963366" />
        <title>Sprague Cats</title>
        <link
            href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css"
            rel="stylesheet"
        />
        <script defer src="script.js"></script>
        <link rel="icon" type="image/png" href="assets/caticon.png" />
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-1MV9BXLPDE"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "G-1MV9BXLPDE");
        </script>
        <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6495605335963366"
            crossorigin="anonymous"
        ></script>
    </head>

    <body class="bg-gray-100">
        <!-- Header -->
        <div
            class="fixed top-0 left-0 w-full bg-white shadow-md p-4 flex justify-between items-center"
        >
            <div class="flex justify-between w-full align-center">
                <h1 class="text-gray-700 text-lg font-bold">
                    üìç Sprague Cat Tracker
                </h1>
                <button
                    class="bg-blue-50 border border-blue-500 hover:bg-blue-100 text-blue-500 font-bold py-2 px-4 rounded"
                    onclick="shareLink()"
                >
                    Share
                </button>
            </div>
        </div>

        <!-- Content Container -->
        <div class="container mx-auto p-4 mb-16 mt-10">
            <div class="mt-10">
                <!-- Banner Card -->
                <div
                    class="bg-white rounded-lg overflow-hidden shadow-lg shadow-md mb-4 p-4 flex justify-center flex-col"
                >
                    <h2 class="text-lg">We are this old</h2>
                    <div
                        class="grid auto-cols-max grid-flow-col gap-5 text-center"
                    >
                        <div class="flex flex-col">
                            <span class="countdown font-mono text-5xl">
                                <span id="weeks" style="--value: ${counter}"
                                    >10</span
                                >
                            </span>
                            weeks
                        </div>
                        <div class="flex flex-col">
                            <span class="countdown font-mono text-5xl">
                                <span id="days" style="--value: 15">10</span>
                            </span>
                            days
                        </div>
                        <div class="flex flex-col">
                            <span class="countdown font-mono text-5xl">
                                <span id="hours" style="--value: 10">10</span>
                            </span>
                            hours
                        </div>
                        <div class="flex flex-col">
                            <span class="countdown font-mono text-5xl">
                                <span id="mins" style="--value: 24">10</span>
                            </span>
                            min
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 mb-4 gap-4">
                    <div class="w-full h-full">
                        <div class="bg-white p-6 shadow-lg rounded-lg">
                            <h2 class="text-lg font-semibold text-gray-800 mb-5"></h2>
                                Kitten Weights by Day
                            </h2>
                            <div>
                                <canvas height="300" id="myChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="w-full h-full">
                        <div class="bg-white p-6 shadow-lg rounded-lg">
                            <h2 class="text-lg font-semibold text-gray-800 mb-5"></h2>
                                Podium Chart
                            </h2>
                            <div>
                                <canvas height="300" id="podiumChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card Container -->
                <div
                    id="cat-container"
                    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"
                ></div>

                <!-- Gallery Link -->
                <div
                    class="mt-4 bg-white rounded-lg overflow-hidden shadow-lg shadow-md mb-4 p-4 flex justify-between flex-wrap items-center"
                >
                    <p>More pictures:</p>
                    <button
                        class="bg-blue-50 border border-blue-500 hover:bg-blue-100 text-blue-500 font-bold py-2 px-4 rounded"
                        onclick="location.href='/CatDashboard/gallery'"
                    >
                        Go to Gallery
                    </button>
                </div>
            </div>
        </div>

        <!-- Banner -->
        <div
            class="fixed bottom-0 left-0 w-full bg-blue-50 shadow-md p-4 flex justify-between items-center"
        >
            <p class="mx-auto text-gray-700">
                Kittens are moving into a new enclosure. Stream to return soon
                üöß üë∑üèº
            </p>
            <!-- <button
                onclick="navigateToUrl('https://youtube.com/live/UpI2SFT6nms?feature=share')"
                target="_blank"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
                >Go To Stream</
            > -->
        </div>
    </body>

    <!-- timer functionality -->
    <script>
        const kittenBirthday = new Date(2024, 5, 8); // June 8, 2024

        function updateAge() {
            const now = new Date();
            const ageInSeconds = Math.floor((now - kittenBirthday) / 1000);

            const weeks = Math.floor(ageInSeconds / (60 * 60 * 24 * 7));
            const days = Math.floor((ageInSeconds / (60 * 60 * 24)) % 7);
            const hours = Math.floor((ageInSeconds / (60 * 60)) % 24);
            const minutes = Math.floor((ageInSeconds / 60) % 60);

            document.getElementById("weeks").textContent = `${weeks}`;
            document.getElementById("days").textContent = `${days}`;
            document.getElementById("hours").textContent = `${hours}`;
            document.getElementById("mins").textContent = `${minutes}`;
        }

        updateAge();
        setInterval(updateAge, 1000);
    </script>

    <script>
        function navigateToUrl(url) {
            window.open(url, "_blank").focus();
        }
    </script>
    <

    <!-- share functionality -->
    <script>
        function shareLink() {
            const shareData = {
                title: "Sprague Cats",
                text: "Check out these kittens!",
                url: "https://colbysprague.github.io/CatDashboard",
            };

            if (navigator.share) {
                navigator
                    .share(shareData)
                    .then(() => console.log("Shared successfully"))
                    .catch((error) => console.error("Error sharing:", error));
            } else {
                // Fallback for browsers that do not support native sharing
                const tempInput = document.createElement("input");
                tempInput.value = shareData.url;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand("copy");
                document.body.removeChild(tempInput);
                alert("Link copied to clipboard!");
            }
        }
    </script>

    <!-- chart -->
    <script>
        function getLastNDays(n) {
            const dates = [];
            const today = new Date();

            for (let i = n - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(today.getDate() - i);
                const month = date.getMonth() + 1; // Months are zero-based
                const day = date.getDate();
                dates.push(`${month}/${day}`);
            }

            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);
            const tomorrowMonth = tomorrow.getMonth() + 1;
            const tomorrowDay = tomorrow.getDate();
            dates.push(`${tomorrowMonth}/${tomorrowDay}`);

            return dates;
        }

        async function loadJSON() {
            const url =
                "https://raw.githubusercontent.com/colbysprague/CatDashboard/main/kittenData.json";

            try {
                const response = await fetch(url);
                const data = await response.json();
                // const numDays = data[0].weight.length;
                const numDays = 8;
                createWeightChart(data, numDays);
                createPodiumChart(data, numDays);
            } catch (error) {
                console.error("Error fetching the file:", error);
            }
        }

        function createImage(image, url) {
            image = image.cloneNode();
            image.height = 30;
            image.width = 30;
            image.src = url;
            return image;
        }

        function createWeightChart(catData, numDays) {
            let chartLabels = getLastNDays(numDays);
            const ctx = document.getElementById("myChart").getContext("2d");

            new Chart(ctx, {
                type: "line",
                data: {
                    labels: chartLabels,
                    datasets: catData
                        .filter((cat) => cat.isKitten)
                        .map((cat) => ({
                            label: cat.name,
                            backgroundColor: cat.color,
                            borderColor: cat.color,
                            data: cat.weight.slice(-numDays),
                            pointStyle: function (context) {
                                return context.dataIndex === numDays - 1
                                    ? createImage(new Image(), cat.emojiURL)
                                    : "circle";
                            },
                            tension: 0.4,
                        })),
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            // max: 450,
                        },
                    },
                },
            });
        }

        function createPodiumChart(catData) {
            console.log(catData)

            // const podiumCtx= document.getElementById("newChart").getContext("2d");

            new Chart(document.getElementById("podiumChart").getContext("2d"), {
                type: "bar",
                data: {
                    labels: ["Cat 1", "Cat 2", "Cat 3"],
                    datasets: [{
                        label: 'Number of Points',
                        data: [1, 3, 2],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                display: false
                            },
                            y: {
                                display: false
                            }
                        },
                        elements: {
                            bar: {
                                borderWidth: 0
                            }
                        }
                    }
            });
        }

        loadJSON();
    </script>

</html>
